%ul#breadcrumbs.clearfix
  %li.first
    %a{href: '/'} Home
  %li.second
    %a{href: url(:project, @project.slug)}
      Project:
      = @project.name
  %li.third
    Activity

.leftCols
  .outerPanel
    .toolbar.clearfix.activityfix
      .leftCol
        %h2 Activity
      .rightCol

    .innerPanel.clearfix
      %table#activity.marginFix{cellspacing: "0"}
        %tr
          %th When
          %th Event
        - anonymous_user = Fundry::User::Anonymous.get
        - events = paginate(@project.events(order: [:id.desc]), limit: 50)
        - events.each do |event|
          - case event
            - when Fundry::Event::Project::Create
              %tr
                %td!= timeago event.created_at
                %td
                  %img.imgLeft{src: gravatar_url(event.user, 28), width:"28", height:"28"}
                  %strong
                    %a{href: url(:profile, event.detail[:user][:id])}= event.detail[:user][:name]
                  %br
                  created project
                  %a{href: url(:project, event.project_slug)}= event.detail[:project][:name]
            - when Fundry::Event::Feature::Create
              %tr
                %td!= timeago event.created_at
                %td
                  %img.imgLeft{src: gravatar_url(event.user, 28), width:"28", height:"28"}
                  %strong
                    %a{href: url(:profile, event.detail[:user][:id])}= event.detail[:user][:name]
                  %br
                  requested feature
                  %a{href: url(:feature, event.feature_slug)}= event.detail[:feature][:name]
            - when Fundry::Event::Pledge::Create, Fundry::Event::Pledge::Retract, Fundry::Event::Pledge::Paid, Fundry::Event::Pledge::Refunded
              %tr
                %td!= timeago event.created_at
                %td
                  %img.imgLeft{src: gravatar_url(event.user, 28), width:"28", height:"28"}
                  %strong
                    %a{href: url(:profile, event.detail[:user][:id])}= event.detail[:user][:name]
                  %br
                  != event.title
                  != money BigMoney.new(event.detail[:pledge][:balance][:amount], event.detail[:pledge][:balance][:currency])
                  to:
                  %a{href: url(:feature, event.feature_slug)}= event.detail[:feature][:name]
            - when Fundry::Event::Donation::Create
              %tr
                %td!= timeago event.created_at
                %td
                  - if event.detail[:donation][:anonymous]
                    %img.imgLeft{src: gravatar_url(anonymous_user, 28), width:"28", height:"28"}
                    %strong Anonymous user
                  - else
                    %img.imgLeft{src: gravatar_url(event.user, 28), width:"28", height:"28"}
                    %strong
                      %a{href: url(:profile, event.detail[:user][:id])}= event.detail[:user][:name]
                  %br
                  donated
                  != money BigMoney.new(event.detail[:donation][:balance][:amount], event.detail[:donation][:balance][:currency])
                  to:
                  %a{href: url(:project, event.project_slug)}= event.detail[:project][:name]

        != paginate_control events

.rightCols
  != partial :'project/panel/_statistics'

